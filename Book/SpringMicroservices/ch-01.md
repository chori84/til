# 쉽게 알아보는 마이크로서비스
마이크로서비스를 SOA와 12요소 애플리케이션과 공통점 및 관계를 알아본다.

## 마이크로서비스로의 진화

### 마이크로서비스로 진화의 촉매: 비즈니스적 요구
- 마이크로서비스는 일체형 애플리케이션에 비해 애자일성, 변경 및 배포 신속성, 확장성 측면에서 더 나은 결과물을 만들어낼 수 있다.
- 기업은 수년 전에는 처음부터 끝까지 비즈니스 기능 전체를 아우르는 통합 애플리케이션을 개발하는데 관심을 기울였지만, 이제는 그렇지 않다.
- 마이크로서비스는 전체 소요 비용을 낮출 수 있다.
- 거대한 하나의 시스템을 재구축 하는거 보다 가능한 애자일한 방식으로 개발하는데 초점을 맞춘다.
- 기존 시스템이 응답할 때 새 기능을 거쳐가게 하거나 기존 시스템 내에서 새로운 기능을 호출하게 수정한다.
- 이런 새 기능이 마이크로서비스로 작성된다.

### 마이크로서비스로 진화의 촉매: 기술
- 여러 종류의 기술적 패러다임의 변화는 소프트웨어 아키텍쳐 관점에서도 모든 계층의 구조를 다시 생각해보게 만들었다.
- HTML5, CSS3, 모바일 어플의 발전, FE 프레임워크, 클라우드의 도입, Docker 등장, iPaaS 서비스 등장, NoSQL DB 등등

### 명령형 아키텍처의 진화
- 과거에는 여러 아키텍처와 스타일이 있어지만 모두 일체형 아키텍처 형태였다.
- 마이크로서비스는 현대적인 비즈니스에서 요구하는 특성들을 만족시키며 발전해왔다.
- 마이크로서비스는 일체형 애플리케이션의 경계를 허물고 시스템을 독립적인 더 작은 시스템으로 나눠 구축한다.

## 마이크로서비스란 무엇인가?
- 물리적으로 분리할 수 있는 모듈화된 애플리케이션을 만들 수 있는 방법을 제시한다.
- 분할 정복 기법을 이용해서 일체형 애플리케이션을 단일 기능을 수행하는 더 작은 크기로 분할한다.
- 마이크로서비스는 알리스타 콕번이 창안한 육각형 아키텍처에 사용된 아이디어에서 시작됐다.
- N-티어 형식의 애플리케이션은 계층은 물리적으로 분리 가능하지만, 계층 내 모듈은 고정적으로 내장 돼 있다.
- 마이크로서비스는 자신만의 프레젠테이션 계층, 비즈니스 계층, 데이터베이스 계층을 갖고 있다.
- 하나의 마이크로서비스에서 발생한 변경은 다른 마이크로서비스에 영향을 미치지 않는다.
- 마이크로서비스 간의 통신은 정해진 표준 없이 다양한 방법으로 가능하다. (HTTP, REST, JMS, AMQP, Thrift, ZeroMQ, Protocol Buffers, Avro…)
- 데브옵스와 클라우드 기반의 서비스를 시작하는데 이상적일 수 있다.

## 마이크로서비스와 벌집
- 마이크로서비스는 벌집 처럼 각각이 독립적이고 서로 연결되 있지만 내부가 추상화 되있다.
- 하나가 망가지더라도 다른 것에 영향을 주지 않고, 전체에 영향 없이 수리 가능하다.

## 마이크로서비스의 원칙

### 서비스 하나에 책임도 하나
- 하나의 마이크로서비스는 하나의 책임만 가진다.

### 마이크로서비스는 자율적
- 각각의 마이크로서비스는 여러 자원을 독립적으로 관리하고 독립형 자바 프로세스로 실행된다.

## 마이크로서비스의 특징

### 서비스는 일급 시민
- 종단점을 API 형태로 외부에 노출하고, 내부 사항은 추상화하여 모두 숨긴다.

- 마이크로서비스 안에 있는 서비스들의 특징
    - 서비스 계약에 의해 작성되고, 일반적으로 JSON과 REST로 서비스 커뮤니케이션 한다.
    - 서로 느슨하게 연결되어 메시징, HTTP, REST로 서로 커뮤니케이션 한다.
    - 모든 라이브러리와 환경 전체를 추상화한다.
    - 마이크로서비스는 덩어리째 재사용 가능하다.
    - 상태 관리는 DB나 메모리를 이용해 관리하고 마이크로서비스는 무상태이다.
    - 탐색을 통해 찾고, 서비스가 중지되면 소속 환겨에서 스스로를 제거한다.
    - 표준 프로토콜과 메시지 교환 표준을 준수하여 호환성이 좋다.
    - 조립이 가능하다.

### 마이크로서비스는 경량
- 하나의 비즈니스만 책임지기 때문에 적은 공간을 차지한다.
- 지원 기술을 선택할 때 가벼운지 확인해야 한다.
- Jetty, Tomcat / Docker > WebLogic, WebSphere / VMWare, Hyper-V

### 다양한 언어로 구성할 수 있는 마이크로서비스
- 내부 사항을 숨기기 때문에 각각 서로 다른 아키텍처(버전, 언어, DB, 등등)를 적용할 수 있다.

### 마이크로서비스 환경에서 자동화
- 마이크로서비스는 여러 개의 작은 서비스로 분리하기 때문에 상당히 많은 마이크로서비스가 존재 할 수 있다.
- 따라서 자동화하지 않으면 관리 부담이 크다.
- 빌드, 테스트, 배포, 확장 등 모든 과정을 자동화 한다.

### 마이크로서비스를 지원하는 생태계
- 데브옵스, 모니터링, 서비스 라우팅, 작업 흐름 통제 메커니즘 등

### 동적이고 분산돼 있는 마이크로 서비스
- 데이터와 로직이 분산되어 있다.
- 쇼핑을 예를 들어 쇼핑은 독립적으로 분리된 하나의 서비스로 동작하며, 고객, 상품, 주문 정보와 결합되지 않은 상태로 상호작용한다.

### 붕괴 저항성, 빨리 실패하기, 자체 치유
- 붕괴 저항성은 개발 과정에서 안전장치가 포함된 시스템을 만들 수 있게 해주는 접근 방식 중 하나
- 빨리 실패하기는 장애를 견딜 수 있고 회복력 좋은 시스템을 구축하는데 사용된다.
- 자체 치유는 시스템이 장애로부터 학습하고 스스로 장애에 적응 시킨다.

## 마이크로서비스 예제
- 생략...

## 마이크로서비스의 장점

### 폴리글랏 아키텍처 지원
- 각각의 마이크로서비스는 각자의 역할과 목적에 맞게 서로 다른 아키텍처와 언어, 버전으로 구축하고 운영할 수 있다.

### 실험과 혁신 유도
- 새로운 기능의 마이크로서비스를 만들어서 적용하고 기대에 미치지 않으면 간단히 다른 서비스와 교체하거나 제거할 수 있다.

### 탄력적이고 선택적인 확장
- 필요한 서비스만 개별적으로 확장, 축소 할 수 있어서 서비스 확장 비용이 상대적으로 적다.
- 선택적 확장성은 인스턴스의 숫자에만 국한되는 개념이 아니며 마이크로서비스의 아키텍처 방식에까지 영향을 미칠 수 있다.

### 대체 가능성
- 하나의 마이크로서비스를 비슷한 다른 마이크로서비스로 대체 할 수 있다.
- 자체적으로 구축한 다른 마이크로서비스로 대체할 수도 있고, 서드파티 업체가 만든 다른 마이크로서비스로 대체하기도 쉽다.
- 마이크로서비스끼리 느슨하게 연결돼 있고 독립적이기 때문에 다른 서비스에 영향을 최소화 하면서 교체할 수 있다.

### 유기적 시스템 구축 유도
- 시스템이 성장함에 따라 서비스를 더 많이 추가해도 기존 서비스에 미치는 영향을 최소화하고, 많은 자본 투자가 필요 없다.

### 기술적 부채 경감
- 쉬운 서비스 교체로 기술 교체를 최소한의 비용으로 할 수 있다.
- 각각이 독립적이기 때문에 전체에 영향 없이 개별 서비스에 필요한 변경이나 기술 업그레이드가 가능하다.
- 새로운 서비스는 최신 기술로 개발할 수 있다.

### 다양한 버전의 공존
- 모든게 독립적이기 때문에 서로 다른 버전의 서비스가 동일한 환경에 공존한다.
- 무중단 업그레이드나 카나리아 출시도 쉽게 진행 할 수 있다.
- 고객에 따라 다른 버전을 제공해주기 편하다.

### 자기 조직화 시스템 구축 지원
- 메세지 큐를 이용하여 통신하기 때문에 전체 시스템의 영향도 분석을 하지 않고 기존 시스템에 쉽게 추가할 수 있다.
- 추가적인 코드 변경이나 서비스 조율이 필요 없다.

### 이벤트 주도 아키텍처 지원
- 입력 / 출력 이벤트를 사용해서 동작하기 때문에 이벤트를 추출하기 쉽다.
- 이벤트 집계 마이크로서비스를 추가하면 된다.

### 데브옵스 지원
- 많은 데브옵스 도구와 기술은 마이크로서비스를 사용하면서 진화하고 있다.
- 규모가 작기 때문에 일체형 애플리케이션에 비해 테스팅 친화적이며, 데브옵스의 요구 사항을 더 쉽게 만족시킬 수 있다.

## 다른 아키텍처 스타일과의 관계

### SOA와의 관계
- 마이크로 서비스와의 비슷한 측명 :
서비스를 지향한다는 점, 다른 서비스들의 조합에 의해 구성, 사용자에게는 블랙박스처럼 내부가 보이지 않는다.
- 차이점 :
SOA는 광범위하게 사용되는 용어라 SOA를 어떤 방식으로 접근하냐에 따라 마이크로서비스와 다를 수도 같을 수도 있다.
- 서비스 지향 통합
    - 서비스 기반 통합
    - 통합에 수반되는 복잡성을 해결하기 위해 SOA 사용
    - 어떤 공용의 통합 계층을 통해 서로 의사소통한다.
    - SOA 제품을 사용하는 조직은 제품의 의존도가 깊다
    - ESB를 통해 조율, 배포, 접근을 하게 된다.
    - 이 경우 SOA와 마이크로서비스는 다르다.
- 기본 시스템의 현행화
    - SOA는 레거시 위에 서비스 계층을 구축하는데 사용
    - 전환 프로젝트나 레거시 현행화에 사용한다.
    - ESB 레이어 내부에 서비스를 만든다.
    - 이 경우도 SOA와 마이크로서비스는 다르다.
- 서비스 지향 애플리케이션
    - SOA를 애플리케이션 수준에 적용
    - 프로토콜 중개, 병렬 실행, 서비스 통합 같은 문제를 경량 통합 프레임워크를 통해 해결
    - 서비스 간의 통합이나 데이터 교환을 위해 POJO 사용
    - 모든 서비스가 하나의 일체형 웹 아카이브에 패키징
    - 다음 단계가 마이크로서비스

### SOA를 사용한 일체형의 전환
- 일체형 애플리케이션을 작은 단위로 변형 시킬 때 SOA를 사용
- 애플리케이션을 하위 시스템으로 분리하고 웹 아카이브로 만들어 웹서버에 배포하거나 JAR로 만들어 자체적인 컨테이너에 배포
- 서비스 간의 데이터 교환을 위해 웹 서비스나 경량 프로토콜 사용
- 마이크로서비스가 옛날 것과 똑같다고 생각

### 12 요소 애플리케이션과의 관계
- 클라우드가 빠르게 진화하고 있으면서 많은 조직이 기존 애플리케이션을 클라우드로 옮기고 있다.
- 클라우드에선 인프라스트럭처가 애플리케이션에 대해 투명해야 하며, 물리적인 요소를 추측하면 안된다.
- 12 요소 애플리케이션
    - 단일 코드 베이스
        - 각 애플리케이션은 하나의 코드 베이스만 가져야한다.
        - 마이크로서비스 : 각 마이크로서비스는 하나의 코드 베이스만 가져야 한다.
    - 의존성 꾸러미
        - 필요한 모든 의존성은 애플리케이션과 함께 꾸러미에 담는다.
        - 마이크로서비스 : 실행 가능한 모든 라이브러리를 묶어 실행 꾸러미를 만든다.