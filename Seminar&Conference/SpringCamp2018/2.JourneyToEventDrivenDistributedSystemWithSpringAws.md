# 이벤트 기반 분산 시스템을 향한 여정 (journey to event-driven distributed system with spring, aws)
https://www.slideshare.net/arawnkr/ss-94475606

- 서비스 : 독립적으로 실행 가능한 애플리케이션
- 시스템 : 여러 서비스 + 공유 인프라

## 수동 시스템의 한계
- 서비스 이용이 많이짐에 따라 사람의 힘으로 감당하기 힘들어짐
- 자동화 시스템 필요 요구

## 자동화 시스템
- 상용화 솔루션 구매
- 기존의 배민찬과 통합 필요

### 어댑터 서비스 개발
- 이질적 시스템 간의 연결
- 레거시와 신규 시스템의 연결
- 시스템간 이질적인 용어와 모델 번역
- 메시징 기반으로 비동기 처리, 시스템간 결합
    - 수신된 메시지의 멱등성
        - 동일만 주문에 대해서 중복 배송 안되도록
        - aws의 MQ : 똑같은 메세지가 두번 이상 올 수 있기 때문에 중복 되지 않도록 처리
- 레거시 시스템
    - 수정 어려움
    - 사이드 이펙트 발생
- 확장성 있는 아키텍처의 필요성.
    - 새 술은 새 부대에

### 도메인 등장
- 도메인 지식 기반으로 도메인 경계 구분
    - 이름을 붙여 구분 할 수 있도록 도메인 경계가 구분 됨
    - 도메인별로 패키지로 모듈 구성
    - bounded context (DDD 용어)

### 왜 모듈화?
- 비즈니스와 도메인 지식이 낮음에 따라 경계가 모호
- 모듈화에 따라 경계 구분을 뚜렷하게 하기 위함.
- 장점
    - 모듈간 상호 작용이 내부 프로세스로 처리
    - 단일 트랜젝션 관리로 인해 강력한 일관성 확보
    - IDE를 통한 손쉬운 리팩토링

### 모놀리식 시스템화
- 모듈간 직접 참조
- 단일 시스템 안에서 서로가 서로를 잘 알고 있고 서로 결합이 강하게 되있음.
- 이벤트 기반 아키텍처로 모듈간의 결합을 낮추길 기대함.

### 이벤트 기반
- 생산자
    - 이벤트 생성
    - ApplicationEventPublisher
- 소비자
    - 이벤트 소비
    - ApplicationListener
    - @EventListener (Spring 4.2+)
- 채널
    - 생산자와 소비자 연결
    - ApplicationContext
- 생산자가 이벤트를 발행하면 그 이벤트를 사용하겠다고 한 소비자에게 전달해 줌.

### 도메인 이벤트 기반으로 통합 모듈
- 이벤트 기반으로 모듈간의 결합도가 낮아짐
    - 이벤트를 받아 처리

### 원격 시스템 등장
- 분산된 모놀리식, 마이크로리스
- 시스템 또는 서비스 통합을 위한 세가지 방법
    - RPC
        - 시스템간에 결합도가 강해짐.
    - REST API
        - 가장 효율적인 통합
        - 네트워크가 필요함에 따라 장애 관리 필요
    - MQ
        - 비동기, 메시징 기반의 통합
        - 이벤트 기반과 유사함.
        - 주고 받는 메세지가 많아 질 수록 시스템 전체를 파악하기 어려워지는 단점
- 컨텍스트간의 협업을 위한 두가지 방식
    - 동기
        - 요청과 응답
            - callback을 이용하여 비동기로도 구현 가능
    - 비동기
        - 이벤트 기반
            - request-reply 방식으로 동기로도 구현 가능
- 데이터를 실시간으로 가져갈 때
    - REST
- 무엇인가 동작을 해야 할 때
    - 메세지 기반
- 어댑터를 이용해 메세지를 통제

### 어떤 메세지 시스템?
- Amazon SNS + Amazon SQS
    - SNS에서 메세지 발행
    - SQS를 통해 각 서비스가 수신
- Spring Messaging
    - MQ를 위한 project
    - MQ 관리를 손쉽게 해준다.
- Spring Cloud Stream
    - 이벤트 기반 시스템을 만들 떄 사용
    - aws를 지원하지 않는다...ㅠㅠ
